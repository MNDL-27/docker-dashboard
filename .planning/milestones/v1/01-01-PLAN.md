---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - apps/api/src/lib/prisma.ts
  - apps/api/src/models/.gitkeep
autonomous: true
requirements:
  - IDTY-01
  - IDTY-02
  - IDTY-03
  - IDTY-04
  - IDTY-05
  - IDTY-06

must_haves:
  truths:
    - User can sign up with email and password
    - User can log in and stay logged in via session cookies
    - User can create Organizations (tenants)
    - User can create Projects within an Organization
    - User can invite other users to Organization
    - User can have RBAC roles: Owner, Admin, Operator, Viewer
  artifacts:
    - path: prisma/schema.prisma
      provides: Database schema with User, Organization, Project, Membership, Session models
      contains: model User, model Organization, model Project, model Session
    - path: apps/api/src/lib/prisma.ts
      provides: Prisma client singleton
      exports: prisma
  key_links:
    - from: apps/api/src/routes/auth.ts
      to: prisma/schema.prisma
      via: Prisma client
      pattern: prisma\\.user\\.(create|findUnique)
---

<objective>
Create database schema with Prisma for users, organizations, projects, RBAC, and session storage.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-foundation-identity/01-RESEARCH.md
@.planning/phases/01-foundation-identity/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Prisma schema with all models</name>
  <files>prisma/schema.prisma</files>
  <action>
Create Prisma schema at prisma/schema.prisma with:

1. User model: id (UUID), email (unique), passwordHash, name, createdAt, updatedAt
2. Session model: sid (string, primary), sess (json), expire (timestamp) - for connect-pg-simple
3. Organization model: id (UUID), name, slug (unique), createdAt, updatedAt
4. OrganizationMember model: id (UUID), userId, organizationId, role (OWNER|ADMIN|OPERATOR|VIEWER), createdAt
5. Project model: id (UUID), name, organizationId, createdAt, updatedAt
6. ProjectMember model: id (UUID), userId, projectId, role, inheritedFromOrg (boolean), createdAt

Use PostgreSQL provider. Include proper relations and indexes.
  </action>
  <verify>
npx prisma generate
  </verify>
  <done>Prisma client generated with User, Organization, Project, Session models and RBAC enums</done>
</task>

<task type="auto">
  <name>Task 2: Create Prisma client singleton</name>
  <files>apps/api/src/lib/prisma.ts</files>
  <action>
Create apps/api/src/lib/prisma.ts with PrismaClient singleton pattern:
- Import PrismaClient from @prisma/client
- Export singleton instance for use across the API
- Handle connection pooling properly for production
  </action>
  <verify>
ls apps/api/src/lib/prisma.ts
  </verify>
  <done>Prisma client singleton exists and can be imported</done>
</task>

</tasks>

<verification>
Run `npx prisma db push` to create tables in local PostgreSQL
</verification>

<success_criteria>
Database tables created: users, sessions, organizations, organization_members, projects, project_members
</success_criteria>

<output>
After completion, create .planning/phases/01-foundation-identity/01-01-SUMMARY.md
</output>
