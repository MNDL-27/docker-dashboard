---
phase: 01-foundation
plan: 07
type: execute
wave: 3
depends_on:
  - 04
  - 02
files_modified:
  - apps/api/src/index.ts
  - apps/api/package.json
autonomous: true
requirements:
  - DEV-04

must_haves:
  truths:
    - cloud-api runs locally
  artifacts:
    - path: apps/api/src/index.ts
      provides: Express server entry point
      exports: running server
    - path: apps/api/package.json
      provides: API package dependencies
      contains: express, express-session, connect-pg-simple
  key_links:
    - from: apps/api/src/index.ts
      to: apps/api/src/routes/auth.ts
      via: router
      pattern: app.use.*auth
    - from: apps/api/src/index.ts
      to: apps/api/src/config/session.ts
      via: middleware
      pattern: app.use.*session
---

<objective>
Create Express API server entry point that runs locally via Docker Compose.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-foundation-identity/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Express server entry point</name>
  <files>apps/api/src/index.ts</files>
  <action>
Create apps/api/src/index.ts:

1. Import express, cors, session middleware, route handlers
2. Configure CORS for web app (port 3000)
3. Apply session middleware
4. Apply route handlers: /auth, /organizations, /projects, /invites
5. Health check endpoint: GET /health
6. Listen on PORT from env (default 3001)
7. Add basic error handling middleware
  </action>
  <verify>
ls apps/api/src/index.ts
  </verify>
  <done>Express server entry point exists</done>
</task>

<task type="auto">
  <name>Task 2: Configure API package.json</name>
  <files>apps/api/package.json</files>
  <action>
Create apps/api/package.json with:

- name: cloud-api
- main: src/index.ts  
- dependencies: express, cors, express-session, connect-pg-simple, pg, bcrypt, zod
- devDependencies: typescript, @types/*, ts-node, prisma
- scripts: dev (ts-node), build (tsc), start

Ensure prisma generate is in postinstall.
  </action>
  <verify>
cat apps/api/package.json | grep -A5 '"dependencies"'
  </verify>
  <done>API package.json has required dependencies</done>
</task>

</tasks>

<verification>
Start API via docker-compose and test: curl http://localhost:3001/health
</verification>

<success_criteria>
API server starts, responds to health check, routes work
</success_criteria>

<output>
After completion, create .planning/phases/01-foundation-identity/01-07-SUMMARY.md
</output>
