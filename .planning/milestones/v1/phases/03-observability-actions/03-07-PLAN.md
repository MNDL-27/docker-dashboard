---
phase: 03-observability-actions
plan: 07
type: execute
wave: 6
depends_on: ["03-05", "03-06"]
files_modified:
  - apps/web/src/components/observability/ActionMenu.tsx
  - apps/web/src/app/(dashboard)/fleet/[hostId]/[containerId]/page.tsx
autonomous: true
requirements:
  - ACTN-01
  - ACTN-02
  - ACTN-03
  - ACTN-04
  - ACTN-05

must_haves:
  truths:
    - Web UI exposes Start/Stop/Restart buttons on container detail pages
    - Actions prompt for an explicit reason/confirmation
    - Stop action is disabled or blocked for users without Admin role for "protected" containers
  artifacts:
    - path: apps/web/src/components/observability/ActionMenu.tsx
      provides: Dropdown or button group for lifecycle actions
---

<objective>
Implement the Web UI components for triggering container lifecycle actions (Start, Stop, Restart), enforcing confirmation prompts, and basic role-based UI restrictions.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
@.planning/phases/03-observability-actions/RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Action Menu Component</name>
  <files>apps/web/src/components/observability/ActionMenu.tsx</files>
  <action>
Create the UI for actions:
- Implement a dropdown or button group exposing "Start", "Stop", "Restart".
- When an action is clicked, open a confirmation Dialog (ACTN-04). This dialog must contain a text input for "Reason" (optional, but the prompt itself is mandatory).
- Expose a prop `onAction(action: string, reason: string)` to bubble the event up to the page.
  </action>
  <verify>npm run build</verify>
  <done>Action Menu renders correctly with confirmation dialogs</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Action API with UI</name>
  <files>apps/web/src/app/(dashboard)/fleet/[hostId]/[containerId]/page.tsx</files>
  <action>
Wire the Action Menu into the Container Detail page:
- Place the `ActionMenu` prominently on the page header.
- Implement the `onAction` handler: It should call `POST /api/containers/:id/actions` via the `apiFetch` utility with the selected action and reason.
- Display a loading state or toast notification while waiting for the response. 
  </action>
  <verify>npm run build</verify>
  <done>User interactions accurately trigger REST API POST requests</done>
</task>

<task type="auto">
  <name>Task 3: Enforce Protected Container Policy</name>
  <files>apps/web/src/components/observability/ActionMenu.tsx</files>
  <action>
Implement client-side RBAC for actions:
- Accept the current user's role (from global state or props).
- Accept a boolean `isProtected` (this can be mocked or derived from labels like `com.docker.dashboard.protected=true`).
- If `isProtected` is true AND the user role is `Operator` or `Viewer`, disable the "Stop" button natively in the UI with a tooltip explaining why (ACTN-05).
  </action>
  <verify>npm run build</verify>
  <done>UI correctly disables restricted actions based on user role</done>
</task>

</tasks>

<verification>
Ensure `npm run build` in `apps/web` compiles successfully, proving component integration is type-safe.
</verification>

<success_criteria>
- Start, Stop, and Restart actions are available to the user.
- A confirmation dialog is required to proceed.
- Protected container stops are disabled for non-Admin users in the UI.
</success_criteria>

<output>
After completion, create .planning/phases/03-observability-actions/03-07-SUMMARY.md
</output>
