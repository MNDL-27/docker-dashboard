---
phase: 01-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docker-compose.dev.yml
  - docker-compose.base.yml
  - scripts/setup-env.sh
  - .env.example
autonomous: true
requirements:
  - DEV-01
  - DEV-02
  - DEV-03

must_haves:
  truths:
    - Local dev environment via docker-compose.dev.yml
    - Postgres available in local dev
    - Redis available in local dev
  artifacts:
    - path: docker-compose.base.yml
      provides: Base docker-compose with PostgreSQL, Redis, LocalStack
      contains: services: db, redis, localstack
    - path: docker-compose.dev.yml
      provides: Local dev overrides for api, web, agent
      contains: services: api, web, agent
    - path: scripts/setup-env.sh
      provides: Environment setup script
      contains: generates .env file
  key_links:
    - from: docker-compose.dev.yml
      to: docker-compose.base.yml
      via: extends
      pattern: extends.*base
---

<objective>
Set up local development environment with Docker Compose including PostgreSQL, Redis, and LocalStack.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-foundation-identity/01-RESEARCH.md (Pattern 3: Docker Compose Base + Override)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create docker-compose.base.yml</name>
  <files>docker-compose.base.yml</files>
  <action>
Create docker-compose.base.yml with:

1. db service: postgres:17-alpine, POSTGRES_USER/DB/PASSWORD from env, volume postgres_data
2. redis service: redis:7-alpine, volume redis_data  
3. localstack service: localstack/localstack:latest, port 4566, SERVICES=s3, volume localstack_data

Include named volumes for data persistence.
  </action>
  <verify>
docker-compose -f docker-compose.base.yml config --services
  </verify>
  <done>Base compose file validates with db, redis, localstack services</done>
</task>

<task type="auto">
  <name>Task 2: Create docker-compose.dev.yml</name>
  <files>docker-compose.dev.yml</files>
  <action>
Create docker-compose.dev.yml that extends base and adds:

1. api service: builds from apps/api, port 3001, depends on db/redis, DATABASE_URL, SESSION_SECRET env vars
2. web service: builds from apps/web, port 3000, depends on api, NEXT_PUBLIC_API_URL env var
3. agent service: builds from packages/agent, env vars for connecting to api

Use override pattern - DO NOT redefine db/redis/localstack.
  </action>
  <verify>
docker-compose -f docker-compose.dev.yml config --services
  </verify>
  <dev_override>Services api, web, agent added with proper dependencies</dev_override>
</task>

<task type="auto">
  <name>Task 3: Create setup-env.sh script</name>
  <files>scripts/setup-env.sh</files>
  <action>
Create scripts/setup-env.sh that:
1. Creates .env file with DATABASE_URL, SESSION_SECRET, REDIS_URL, LOCALSTACK_URL
2. Generates secure random values using openssl or node crypto
3. Outputs clear instructions for what was created
  </action>
  <verify>
bash scripts/setup-env.sh && ls .env
  </verify>
  <done>.env file generated with all required variables</done>
</task>

</tasks>

<verification>
Run docker-compose up -d db redis localstack to verify base services start
</verification>

<success_criteria>
PostgreSQL accessible on port 5432, Redis on 6379, LocalStack S3 on 4566
</success_criteria>

<output>
After completion, create .planning/phases/01-foundation-identity/01-02-SUMMARY.md
</output>
