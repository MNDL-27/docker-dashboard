---
phase: 01-foundation
plan: 05
type: execute
wave: 2
depends_on:
  - 01
files_modified:
  - apps/api/src/routes/organizations.ts
  - apps/api/src/routes/projects.ts
autonomous: true
requirements:
  - IDTY-03
  - IDTY-04

must_haves:
  truths:
    - User can create an Organization (tenant)
    - User can create Projects within an Organization
  artifacts:
    - path: apps/api/src/routes/organizations.ts
      provides: Organization CRUD endpoints
      exports: GET/POST /organizations
    - path: apps/api/src/routes/projects.ts
      provides: Project CRUD endpoints
      exports: GET/POST /organizations/:orgId/projects
  key_links:
    - from: apps/api/src/routes/organizations.ts
      to: prisma/schema.prisma
      via: Prisma client
      pattern: prisma\\.organization\\.(create|findMany)
    - from: apps/api/src/routes/projects.ts
      to: apps/api/src/routes/organizations.ts
      via: orgId param
      pattern: :orgId/projects
---

<objective>
Build Organizations and Projects CRUD API endpoints.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/01-foundation-identity/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create organizations routes</name>
  <files>apps/api/src/routes/organizations.ts</files>
  <action>
Create apps/api/src/routes/organizations.ts with:

1. GET /organizations: List user's organizations (via OrganizationMember)
2. POST /organizations: Create new org, add creator as OWNER member
3. GET /organizations/:id: Get single org with members
4. PATCH /organizations/:id: Update org (name)
5. DELETE /organizations/:id: Delete org (OWNER only)

Require auth. Use requireAuth middleware.
  </action>
  <verify>
ls apps/api/src/routes/organizations.ts
  </verify>
  <done>Organization CRUD endpoints exist</done>
</task>

<task type="auto">
  <name>Task 2: Create projects routes</name>
  <files>apps/api/src/routes/projects.ts</files>
  <action>
Create apps/api/src/routes/projects.ts with:

1. GET /organizations/:orgId/projects: List projects in org (members only)
2. POST /organizations/:orgId/projects: Create project in org (ADMIN/OPERATOR+)
3. GET /organizations/:orgId/projects/:id: Get single project
4. PATCH /organizations/:orgId/projects/:id: Update project (name)
5. DELETE /organizations/:orgId/projects/:id: Delete project (OWNER/ADMIN)

Require auth + org membership.
  </action>
  <verify>
ls apps/api/src/routes/projects.ts
  </verify>
  <done>Project CRUD endpoints exist</done>
</task>

</tasks>

<verification>
After API running: curl -X POST http://localhost:3001/organizations -H "Content-Type: application/json" -d '{"name":"My Org"}' -b cookies.txt
</verification>

<success_criteria>
User can create organization, add projects to it, list and manage them
</success_criteria>

<output>
After completion, create .planning/phases/01-foundation-identity/01-05-SUMMARY.md
</output>
