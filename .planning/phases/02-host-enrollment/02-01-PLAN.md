---
phase: 02-host-enrollment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
autonomous: true
requirements:
  - HOST-07
  - CONT-02

must_haves:
  truths:
    - System can store Host records with Online/Offline status
    - System can store unique HostTokens for enrollment
    - System can store Container snapshots linked to a Host
  artifacts:
    - path: prisma/schema.prisma
      provides: Database schema with Host, HostToken, Container models
      contains: model Host, model HostToken, model Container
---

<objective>
Create database schema for hosts, host enrollment tokens, and container snapshots.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Host and Token models to Prisma schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Update prisma/schema.prisma to include:
1. Host model: id (UUID), organizationId (UUID, relation), name, hostname, os, architecture, dockerVersion, lastSeen (DateTime?), status (String - ONLINE/OFFLINE), createdAt, updatedAt
2. HostToken model: id (UUID), token (unique, default dbgenerated("gen_random_uuid()")), organizationId (relation), createdBy (relation to User), expiresAt (DateTime), usedAt (DateTime?), createdAt
3. Enum for HostStatus (ONLINE, OFFLINE)
  </action>
  <verify>npx prisma validate</verify>
  <done>Host and HostToken models present and valid</done>
</task>

<task type="auto">
  <name>Task 2: Add Container model to Prisma schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Update prisma/schema.prisma to include:
1. Container model: id (UUID), dockerId (String), hostId (UUID, relation), name, image, imageId, command, state (String - running, exited, etc.), status, ports (Json), labels (Json), startedAt (DateTime?), createdAt, updatedAt
2. Define unique constraint on (hostId, dockerId)
  </action>
  <verify>npx prisma format && npx prisma validate</verify>
  <done>Container model is present and linked to Host</done>
</task>

</tasks>

<verification>
Run `npx prisma db push` to verify tables can be created in local PostgreSQL.
</verification>

<success_criteria>
- Schema contains Host, HostToken, Container models
- Schema validates and pushes successfully
</success_criteria>

<output>
After completion, create .planning/phases/02-host-enrollment/02-01-SUMMARY.md
</output>
