---
phase: 02-host-enrollment
plan: 06
type: execute
wave: 5
depends_on: ["02-02"]
files_modified:
  - apps/web/src/app/(dashboard)/fleet/page.tsx
  - apps/web/src/components/fleet/HostList.tsx
  - apps/web/src/components/fleet/AddHostDialog.tsx
autonomous: true
requirements:
  - HOST-01
  - HOST-03
  - CONT-03

must_haves:
  truths:
    - User can view a list of enrolled hosts with aggregate container metrics
    - User can add a host via UI and get an installation command
  artifacts:
    - path: apps/web/src/app/(dashboard)/fleet/page.tsx
      provides: Fleet dashboard page
    - path: apps/web/src/components/fleet/HostList.tsx
      provides: Table or grid of hosts
    - path: apps/web/src/components/fleet/AddHostDialog.tsx
      provides: Dialog to generate token and show command
---

<objective>
Implement the Web UI Fleet view to list enrolled hosts and provide the "Add Host" enrollment workflow.
</objective>

<execution_context>
@C:/Users/proti/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fleet View Page and Host List</name>
  <files>apps/web/src/app/(dashboard)/fleet/page.tsx, apps/web/src/components/fleet/HostList.tsx</files>
  <action>
Create the Fleet view:
- Create `apps/web/src/app/(dashboard)/fleet/page.tsx` with a clean layout.
- Create `HostList.tsx` component to fetch and display hosts from `GET /api/hosts`.
- Display: Name/Hostname, OS/Arch, Status (Online/Offline visual indicator), Last Seen time, Container Count.
- Include a button to open the Add Host dialog.
  </action>
  <verify>Page renders without errors at /fleet</verify>
  <done>List properly fetches from API and shows enrolled hosts</done>
</task>

<task type="auto">
  <name>Task 2: Add Host Workflow Dialog</name>
  <files>apps/web/src/components/fleet/AddHostDialog.tsx</files>
  <action>
Implement `AddHostDialog.tsx`:
- Needs a trigger button ("Add Host").
- On open/confirm, calls `POST /api/hosts/tokens` to get an enrollment token.
- Displays a copyable command box with the generated `curl` or `docker run` command string containing the token and API URL.
- Must handle loading/error states well.
  </action>
  <verify>Dialog opens, API is callable, command text is rendered</verify>
  <done>User is presented with a functioning command they can paste into their host</done>
</task>

</tasks>

<verification>
Ensure the web app builds and the Fleet page correctly calls the backend API and handles the Add Host token generation. 
</verification>

<success_criteria>
- User can see fleet inventory
- User can get command to enroll new agents
</success_criteria>

<output>
After completion, create .planning/phases/02-host-enrollment/02-06-SUMMARY.md
</output>
