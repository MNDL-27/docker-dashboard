(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{960:(e,t,s)=>{"use strict";s.d(t,{n:()=>r});let a=s(5704).env.NEXT_PUBLIC_API_URL||"http://localhost:3001";async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{method:s="GET",body:r,headers:n={}}=t,o=await fetch("".concat(a).concat(e),{method:s,headers:{"Content-Type":"application/json",...n},credentials:"include",body:r?JSON.stringify(r):void 0});if(!o.ok)throw Error((await o.json().catch(()=>({error:"Request failed"}))).error||"HTTP ".concat(o.status));return o.json()}},6982:(e,t,s)=>{Promise.resolve().then(s.bind(s,7877))},7877:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var a=s(5155),r=s(2115),n=s(63),o=s(2619),l=s.n(o),i=s(6265),c=s(9564),d=s(8425),m=s(7734),x=s(3697),u=s(3420),h=s(4344),f=s(46),b=s(4662);function p(e){let{data:t,type:s}=e,r=e=>{try{if(!e)return"";return(0,b.GP)(new Date(e),"HH:mm:ss")}catch(e){return""}},n=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB","TB"][t]};return(0,a.jsxs)("div",{className:"w-full h-80 bg-slate-900 rounded-lg p-4 border border-slate-800",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-slate-400 mb-4 capitalize",children:[s," Usage"]}),(0,a.jsx)("div",{className:"w-full h-[250px]",children:(0,a.jsx)(i.u,{width:"100%",height:"100%",children:(0,a.jsxs)(c.b,{data:t,margin:{top:5,right:20,left:10,bottom:5},children:[(0,a.jsx)(d.d,{strokeDasharray:"3 3",stroke:"#334155",vertical:!1}),(0,a.jsx)(m.W,{dataKey:"timestamp",tickFormatter:r,stroke:"#94a3b8",fontSize:12,tickMargin:10}),"cpu"===s&&(0,a.jsx)(x.h,{stroke:"#94a3b8",fontSize:12,tickFormatter:e=>"".concat(e,"%"),domain:[0,"auto"]}),"memory"===s&&(0,a.jsx)(x.h,{stroke:"#94a3b8",fontSize:12,tickFormatter:n,width:80}),"network"===s&&(0,a.jsx)(x.h,{stroke:"#94a3b8",fontSize:12,tickFormatter:n,width:80}),(0,a.jsx)(u.m,{contentStyle:{backgroundColor:"#0f172a",borderColor:"#334155",color:"#f8fafc"},labelFormatter:r}),"cpu"===s&&(0,a.jsx)(h.N1,{type:"monotone",dataKey:"cpuUsagePercent",stroke:"#3B82F6",strokeWidth:2,dot:!1,isAnimationActive:!1,name:"CPU Usage"}),"memory"===s&&(0,a.jsx)(h.N1,{type:"monotone",dataKey:"memoryUsageBytes",stroke:"#10B981",strokeWidth:2,dot:!1,isAnimationActive:!1,name:"Memory Usage"}),"network"===s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.N1,{type:"monotone",dataKey:"networkRxBytes",stroke:"#F59E0B",strokeWidth:2,dot:!1,isAnimationActive:!1,name:"Network In (RX)"}),(0,a.jsx)(h.N1,{type:"monotone",dataKey:"networkTxBytes",stroke:"#8B5CF6",strokeWidth:2,dot:!1,isAnimationActive:!1,name:"Network Out (TX)"}),(0,a.jsx)(f.s,{})]})]})})})]})}var g=s(5921),j=s(3511),w=s(9867);function N(e){let{logs:t,containerName:s}=e,[n,o]=(0,r.useState)(!1),[l,i]=(0,r.useState)([]),c=(0,r.useRef)(null);return(0,r.useEffect)(()=>{n||i(t)},[t,n]),(0,r.useEffect)(()=>{!n&&c.current&&(c.current.scrollTop=c.current.scrollHeight)},[l,n]),(0,a.jsxs)("div",{className:"flex flex-col bg-[#0d1117] border border-slate-800 rounded-lg overflow-hidden h-[500px]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-slate-900 border-b border-slate-800 px-4 py-2",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-slate-300 font-mono",children:["Terminal: ",s]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>o(!n),className:"p-1.5 rounded-md text-xs font-semibold flex items-center gap-1 transition-colors ".concat(n?"bg-amber-500/20 text-amber-500":"bg-slate-800 text-slate-300 hover:bg-slate-700"),children:[n?(0,a.jsx)(g.A,{className:"w-4 h-4"}):(0,a.jsx)(j.A,{className:"w-4 h-4"}),n?"Resume":"Pause"]}),(0,a.jsx)("button",{onClick:()=>{let e=new Blob([l.map(e=>"[".concat(e.stream,"] ").concat(e.message)).join("\n")],{type:"text/plain"}),t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="".concat(s,"-logs-").concat(new Date().toISOString(),".txt"),a.click(),window.URL.revokeObjectURL(t)},className:"p-1.5 rounded-md bg-slate-800 text-slate-300 hover:bg-slate-700 transition-colors",title:"Download Logs",children:(0,a.jsx)(w.A,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("div",{ref:c,className:"flex-1 overflow-y-auto p-4 font-mono text-[13px] leading-relaxed text-slate-300",children:0===l.length?(0,a.jsx)("div",{className:"text-slate-500 italic",children:"Waiting for log stream..."}):l.map((e,t)=>(0,a.jsxs)("div",{className:"break-all whitespace-pre-wrap flex gap-3 hover:bg-white/5 px-1 rounded",children:[e.timestamp&&(0,a.jsx)("span",{className:"text-slate-500 shrink-0",children:new Date(e.timestamp).toLocaleTimeString()}),(0,a.jsx)("span",{className:"stderr"===e.stream?"text-red-400":"text-slate-300",children:e.message})]},t))})]})}var v=s(3141),y=s(9e3);function k(e){let{containerId:t,state:s,isProtected:n,userRole:o,onAction:l}=e,[i,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(null),[x,u]=(0,r.useState)(""),[h,f]=(0,r.useState)(!1),[b,p]=(0,r.useState)(null),j="running"===s,w="ADMIN"===o||"OPERATOR"===o,N="ADMIN"===o||"OPERATOR"===o,k="ADMIN"===o||"OPERATOR"===o&&!n,S=e=>{m(e),u(""),p(null),c(!0)},A=async()=>{if(d){if(("STOP"===d||"RESTART"===d)&&n&&!x.trim())return void p("A reason is required for actions on protected containers.");f(!0),p(null);try{await l(d,x),c(!1)}catch(e){p(e.message||"Action failed")}finally{f(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex bg-slate-800 rounded-md border border-slate-700 overflow-hidden",children:[(0,a.jsx)("button",{onClick:()=>S("START"),disabled:j||!w,className:"flex items-center justify-center p-2 text-sm font-medium transition-colors border-r border-slate-700 w-12\n            ".concat(j||!w?"text-slate-600 cursor-not-allowed bg-slate-900/50":"text-emerald-400 hover:bg-slate-700"),title:w?"Start Container":"Insufficient permissions",children:(0,a.jsx)(g.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>S("RESTART"),disabled:!j||!N,className:"flex items-center justify-center p-2 text-sm font-medium transition-colors border-r border-slate-700 w-12\n            ".concat(j&&N?"text-amber-400 hover:bg-slate-700":"text-slate-600 cursor-not-allowed bg-slate-900/50"),title:N?"Restart Container":"Insufficient permissions",children:(0,a.jsx)(v.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>S("STOP"),disabled:!j||!k,className:"flex items-center justify-center p-2 text-sm font-medium transition-colors w-12\n            ".concat(j?k?"text-red-400 hover:bg-slate-700 hover:text-red-300":"text-slate-600 cursor-not-allowed bg-slate-900/50 hover:text-red-900":"text-slate-600 cursor-not-allowed bg-slate-900/50"),title:!k&&n?"Cannot stop protected container":k?"Stop Container":"Insufficient permissions",children:(0,a.jsx)(y.A,{className:"w-4 h-4 fill-current"})})]}),i&&d&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",children:(0,a.jsxs)("div",{className:"bg-slate-900 border border-slate-700 rounded-xl shadow-2xl max-w-md w-full p-6 animate-in fade-in zoom-in duration-200",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold text-slate-100 mb-2",children:["Confirm ",d.charAt(0)+d.slice(1).toLowerCase()]}),(0,a.jsxs)("p",{className:"text-slate-400 text-sm mb-6",children:["Are you sure you want to ",d.toLowerCase()," container ",(0,a.jsx)("span",{className:"font-mono text-slate-300",children:t.substring(0,12)}),"?",n&&(0,a.jsx)("span",{className:"block mt-2 text-amber-500 font-semibold text-xs uppercase tracking-wider",children:"Warning: Protected Container"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{htmlFor:"reason",className:"block text-sm font-medium text-slate-300 mb-1",children:["Reason ",n&&("STOP"===d||"RESTART"===d)?(0,a.jsx)("span",{className:"text-red-400",children:"*"}):(0,a.jsx)("span",{className:"text-slate-500",children:"(Optional)"})]}),(0,a.jsx)("textarea",{id:"reason",rows:3,className:"w-full bg-slate-950 border border-slate-800 rounded-md px-3 py-2 text-slate-200 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none sm:text-sm",placeholder:"Enter justification for audit logs...",value:x,onChange:e=>u(e.target.value)}),b&&(0,a.jsx)("p",{className:"mt-2 text-sm text-red-400",children:b})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>c(!1),disabled:h,className:"px-4 py-2 rounded-md font-medium text-slate-300 hover:bg-slate-800 transition-colors text-sm",children:"Cancel"}),(0,a.jsxs)("button",{onClick:A,disabled:h,className:"flex items-center justify-center px-4 py-2 rounded-md font-medium text-white transition-colors text-sm min-w-[100px]\n                  ".concat("STOP"===d?"bg-red-600 hover:bg-red-500":"START"===d?"bg-emerald-600 hover:bg-emerald-500":"bg-amber-600 hover:bg-amber-500","\n                  ").concat(h?"opacity-70 cursor-not-allowed":""),children:[h?(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):null,h?"Executing...":"Confirm"]})]})]})})]})}var S=s(960),A=s(5704);function T(e){var t;let{params:s}=e;(0,n.useRouter)();let{hostId:o,containerId:i}=(0,r.use)(s),[c,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),[f,b]=(0,r.useState)("VIEWER"),[g,j]=(0,r.useState)([]),[w,v]=(0,r.useState)([]),[y,T]=(0,r.useState)("connecting");(0,r.useEffect)(()=>{!async function(){try{let[e,t]=await Promise.all([(0,S.n)("/api/me"),(0,S.n)("/api/hosts/".concat(o,"/containers"))]);b("OPERATOR");let s=t.containers.find(e=>e.id===i||e.dockerId===i);s?d(s):h("Container not found")}catch(e){h(e.message||"Failed to load container data")}finally{x(!1)}}()},[o,i]),(0,r.useEffect)(()=>{let e;if(!c)return;let t=(A.env.NEXT_PUBLIC_API_URL||"http://localhost:3001").replace(/^http/,"ws")+"/ws/client";return T("connecting"),(e=new WebSocket(t)).onopen=()=>{T("connected")},e.onmessage=e=>{try{let t=JSON.parse(e.data);if("metrics"===t.type&&t.metrics){let e=t.metrics.filter(e=>e.containerId===c.dockerId);e.length>0&&j(t=>[...t,...e].slice(-60))}else if("logs"===t.type&&t.logs){let e=t.logs.filter(e=>e.containerId===c.dockerId);e.length>0&&v(t=>[...t,...e].slice(-1e3))}}catch(e){console.error("WS parse error",e)}},e.onclose=()=>{T("disconnected")},()=>{e&&e.close()}},[c]);let C=async(e,t)=>{if(c)try{await (0,S.n)("/api/containers/".concat(c.dockerId,"/actions"),{method:"POST",body:JSON.stringify({action:e,reason:t})}),d(t=>t?"STOP"===e?{...t,state:"exited"}:"START"===e||"RESTART"===e?{...t,state:"running"}:t:t)}catch(t){throw Error(t.message||"Failed to ".concat(e.toLowerCase()," container"))}};if(m)return(0,a.jsx)("div",{className:"p-8 text-slate-400",children:"Loading container..."});if(u||!c)return(0,a.jsxs)("div",{className:"p-8 max-w-7xl mx-auto",children:[(0,a.jsx)(l(),{href:"/fleet/".concat(o),className:"text-slate-500 hover:text-slate-300 font-medium text-sm mb-6 inline-block",children:"← Back to Host"}),(0,a.jsx)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-6 text-red-400",children:u||"Container not found"})]});let R=(null==c||null==(t=c.labels)?void 0:t["com.docker.dashboard.protected"])==="true";return(0,a.jsxs)("div",{className:"p-8 max-w-7xl mx-auto space-y-6",children:[(0,a.jsx)(l(),{href:"/fleet/".concat(o),className:"text-slate-500 hover:text-slate-300 font-medium text-sm inline-block",children:"← Back to Host"}),(0,a.jsxs)("header",{className:"bg-slate-900 border border-slate-800 rounded-lg p-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-slate-100 m-0",children:c.name}),(0,a.jsx)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-semibold ".concat("running"===c.state?"bg-emerald-500/10 text-emerald-400":"bg-slate-500/10 text-slate-400"),children:c.state.toUpperCase()}),(0,a.jsxs)("span",{className:"px-2.5 py-0.5 rounded-full text-xs font-semibold ".concat("connected"===y?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"connecting"===y?"bg-amber-500/10 text-amber-400 border border-amber-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"),children:["WS: ",y.toUpperCase()]})]}),(0,a.jsxs)("div",{className:"text-sm text-slate-400 font-mono",children:[c.image," • ID: ",c.dockerId.substring(0,12)]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)(k,{containerId:c.dockerId,state:c.state,isProtected:R,userRole:f,onAction:C})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[(0,a.jsx)(p,{data:g,type:"cpu"}),(0,a.jsx)(p,{data:g,type:"memory"}),(0,a.jsx)(p,{data:g,type:"network"})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(N,{logs:w,containerName:c.name})})]})}}},e=>{e.O(0,[176,662,528,441,255,358],()=>e(e.s=6982)),_N_E=e.O()}]);